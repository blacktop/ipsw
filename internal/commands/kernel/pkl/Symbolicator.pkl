@go.Package { name = "github.com/blacktop/ipsw/pkg/signature" }
module io.blacktop.Symbolicator

import "package://pkg.pkl-lang.org/pkl-go/pkl.golang@0.8.0#/go.pkl" 

// TODO: byte pattern matching
// TODO: use arg count to match functions with same anchor strings
// TODO: use caller to get more symbols

/// The target for the signatures.
target: String

class Version {
    /// The maximum version supported.
    max: String

    /// The minimum version supported.
    min: String
}

/// The version of the signatures.
version: Version

class Anchor {
    /// The unique string.
    string: String

    /// The segment the string is in.
    segment: String

    /// The section the string is in.
    section: String

    /// The name of the function that uses this as an argument.
    caller: String    
}

class Signature {
    /// The number of args.
    args: UInt16

    /// The unique anchors in function.
    anchors: Listing<Anchor>

    /// The name of the function this signature matches.
    symbol: String

    /// The function prototype.
    prototype: String

    /// The name of the function that calls this function.
    caller: String
}

signatures: Listing<Signature>(isDistinct)